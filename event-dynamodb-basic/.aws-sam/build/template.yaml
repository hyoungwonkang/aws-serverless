AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'event-dynamodb-basic

  Sample SAM Template for event-dynamodb-basic

  '
Globals:
  Function:
    Timeout: 20
    MemorySize: 512
    Runtime: java17
    Architectures:
    - x86_64
Resources:
  ProductTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: serverless-product-Table-khw
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      - AttributeName: timestamp
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      - AttributeName: timestamp
        KeyType: RANGE
      StreamSpecification:
        StreamViewType: NEW_AND_OLD_IMAGES
  AuditLogFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: AuditLogFunction
      Handler: com.example.event.AuditLogHandler::handleRequest
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: ProductTable
      Events:
        StreamTrigger:
          Type: DynamoDB
          Properties:
            Stream:
              Fn::GetAtt:
              - ProductTable
              - StreamArn
            StartingPosition: LATEST
            BatchSize: 1
    Metadata:
      SamResourceId: AuditLogFunction
